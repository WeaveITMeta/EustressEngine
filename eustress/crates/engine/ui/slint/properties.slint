// ============================================================================
// Eustress Engine Studio - Properties Panel
// Dynamic property editor for selected entities
// ============================================================================

import { VerticalBox, HorizontalBox, LineEdit, ScrollView, CheckBox, Slider, ComboBox, SpinBox, GridBox } from "std-widgets.slint";
import { Theme, PanelHeader, PropertyRow } from "theme.slint";

// Property data structure
export struct PropertyData {
    name: string,
    value: string,
    property-type: string, // "string", "float", "int", "bool", "vec3", "color", "enum"
    category: string,
    editable: bool,
    options: [string], // For enum types
}

// Vec3 property component
component Vec3Property inherits Rectangle {
    in property <string> label: "";
    in property <float> vec-x: 0;
    in property <float> vec-y: 0;
    in property <float> vec-z: 0;
    
    callback value-changed(float, float, float);
    
    height: 24px;
    
    HorizontalBox {
        padding-left: 8px;
        padding-right: 8px;
        spacing: 4px;
        
        Text {
            width: 80px;
            text: root.label;
            color: Theme.text-secondary;
            vertical-alignment: center;
        }
        
        // X
        Rectangle {
            horizontal-stretch: 1;
            background: Theme.input-background;
            border-radius: 2px;
            
            HorizontalBox {
                padding: 2px;
                
                Text {
                    width: 14px;
                    text: "X";
                    color: Theme.gizmo-x;
                    font-size: 10px;
                    vertical-alignment: center;
                    horizontal-alignment: center;
                }
                
                LineEdit {
                    horizontal-stretch: 1;
                    text: root.vec-x;
                    input-type: decimal;
                }
            }
        }
        
        // Y
        Rectangle {
            horizontal-stretch: 1;
            background: Theme.input-background;
            border-radius: 2px;
            
            HorizontalBox {
                padding: 2px;
                
                Text {
                    width: 14px;
                    text: "Y";
                    color: Theme.gizmo-y;
                    font-size: 10px;
                    vertical-alignment: center;
                    horizontal-alignment: center;
                }
                
                LineEdit {
                    horizontal-stretch: 1;
                    text: root.vec-y;
                    input-type: decimal;
                }
            }
        }
        
        // Z
        Rectangle {
            horizontal-stretch: 1;
            background: Theme.input-background;
            border-radius: 2px;
            
            HorizontalBox {
                padding: 2px;
                
                Text {
                    width: 14px;
                    text: "Z";
                    color: Theme.gizmo-z;
                    font-size: 10px;
                    vertical-alignment: center;
                    horizontal-alignment: center;
                }
                
                LineEdit {
                    horizontal-stretch: 1;
                    text: root.vec-z;
                    input-type: decimal;
                }
            }
        }
    }
}

// Color property component
component ColorProperty inherits Rectangle {
    in property <string> label: "";
    in property <color> value: white;
    
    callback value-changed(color);
    
    height: 24px;
    
    HorizontalBox {
        padding-left: 8px;
        padding-right: 8px;
        spacing: 8px;
        
        Text {
            width: 80px;
            text: root.label;
            color: Theme.text-secondary;
            vertical-alignment: center;
        }
        
        // Color preview
        Rectangle {
            width: 24px;
            height: 18px;
            background: root.value;
            border-radius: 2px;
            border-width: 1px;
            border-color: Theme.border-color;
            
            TouchArea {
                clicked => {
                    // Open color picker
                }
            }
        }
        
        // Hex input
        LineEdit {
            horizontal-stretch: 1;
            text: "#ffffff";
        }
    }
}

export component PropertiesPanel inherits Rectangle {
    // Properties
    in property <int> selected-count: 0;
    in property <string> selected-class: "";
    in property <[PropertyData]> properties: [];
    
    // Callbacks
    callback on-property-changed(string, string);
    
    background: Theme.panel-background;
    
    VerticalBox {
        padding: 0px;
        spacing: 0px;
        
        // Header showing selection info
        Rectangle {
            height: 32px;
            background: Theme.header-background;
            
            HorizontalBox {
                padding-left: 8px;
                padding-right: 8px;
                
                Text {
                    text: root.selected-count == 0 ? "No selection" :
                          root.selected-count == 1 ? root.selected-class :
                          root.selected-count + " objects selected";
                    color: Theme.text-primary;
                    font-weight: 500;
                    vertical-alignment: center;
                }
            }
        }
        
        if root.selected-count == 0: Rectangle {
            vertical-stretch: 1;
            
            VerticalBox {
                alignment: center;
                
                Text {
                    text: "Select an object to view its properties";
                    color: Theme.text-secondary;
                    horizontal-alignment: center;
                }
            }
        }
        
        if root.selected-count > 0: ScrollView {
            vertical-stretch: 1;
            
            VerticalBox {
                padding: 0px;
                spacing: 0px;
                
                // Transform section
                PanelHeader {
                    title: "Transform";
                    collapsible: true;
                }
                
                Vec3Property {
                    label: "Position";
                    vec-x: 0;
                    vec-y: 0;
                    vec-z: 0;
                }
                
                Vec3Property {
                    label: "Rotation";
                    vec-x: 0;
                    vec-y: 0;
                    vec-z: 0;
                }
                
                Vec3Property {
                    label: "Scale";
                    vec-x: 1;
                    vec-y: 1;
                    vec-z: 1;
                }
                
                // Appearance section
                PanelHeader {
                    title: "Appearance";
                    collapsible: true;
                }
                
                ColorProperty {
                    label: "Color";
                    value: #808080;
                }
                
                PropertyRow {
                    label: "Material";
                    value: "Plastic";
                }
                
                PropertyRow {
                    label: "Transparency";
                    value: "0";
                }
                
                PropertyRow {
                    label: "Reflectance";
                    value: "0";
                }
                
                // Data section
                PanelHeader {
                    title: "Data";
                    collapsible: true;
                }
                
                PropertyRow {
                    label: "Name";
                    value: "Part";
                }
                
                PropertyRow {
                    label: "Archivable";
                    value: "true";
                }
                
                // Physics section
                PanelHeader {
                    title: "Physics";
                    collapsible: true;
                }
                
                PropertyRow {
                    label: "Anchored";
                    value: "true";
                }
                
                PropertyRow {
                    label: "CanCollide";
                    value: "true";
                }
                
                PropertyRow {
                    label: "Massless";
                    value: "false";
                }
                
                // Dynamic properties from binding
                for prop in root.properties: PropertyRow {
                    label: prop.name;
                    value: prop.value;
                    editable: prop.editable;
                    value-changed(val) => { root.on-property-changed(prop.name, val); }
                }
            }
        }
    }
}
