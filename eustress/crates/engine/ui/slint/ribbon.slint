// ============================================================================
// Eustress Engine Studio - Ribbon Component
// Top toolbar with menus, tools, and play controls
// ============================================================================

import { HorizontalBox, VerticalBox, ScrollView } from "std-widgets.slint";
import { Theme, IconButton, ToolbarSeparator } from "theme.slint";

// Grouped toolbar section with icon row + compact category label
component ToolGroup inherits Rectangle {
    in property <string> label: "";
    
    height: 70px;
    background: transparent;
    
    VerticalLayout {
        padding: 0px;
        spacing: 0px;
        
        // Icon row
        HorizontalLayout {
            height: 56px;
            padding-left: 4px;
            padding-right: 4px;
            spacing: 4px;
            alignment: center;
            
            @children
        }
        
        // Category label
        Text {
            height: 14px;
            text: root.label;
            color: Theme.text-secondary;
            font-size: 9px;
            horizontal-alignment: center;
            vertical-alignment: center;
        }
    }
}

// Vertical group divider with subtle line
component GroupDivider inherits Rectangle {
    width: 1px;
    height: 64px;
    background: Theme.border-color;
}

// Dropdown menu item — clickable row with label and shortcut
component DropdownItem inherits Rectangle {
    in property <string> label: "";
    in property <string> shortcut: "";
    in property <bool> enabled: true;
    callback clicked();
    
    height: 24px;
    background: item-touch.has-hover && root.enabled ? Theme.button-hover : transparent;
    opacity: root.enabled ? 1.0 : 0.4;
    
    item-touch := TouchArea {
        enabled: root.enabled;
        mouse-cursor: root.enabled ? pointer : default;
        clicked => { root.clicked(); }
    }
    
    HorizontalLayout {
        padding-left: 10px;
        padding-right: 10px;
        spacing: 12px;
        
        Text {
            horizontal-stretch: 1;
            text: root.label;
            color: Theme.text-primary;
            font-size: 11px;
            vertical-alignment: center;
            overflow: elide;
        }
        
        if root.shortcut != "": Text {
            text: root.shortcut;
            color: Theme.text-secondary;
            font-size: 10px;
            vertical-alignment: center;
        }
    }
}

// Dropdown section header
component DropdownHeader inherits Rectangle {
    in property <string> label: "";
    
    height: 20px;
    
    HorizontalLayout {
        padding-left: 10px;
        
        Text {
            text: root.label;
            color: Theme.text-secondary;
            font-size: 9px;
            font-weight: 600;
            vertical-alignment: center;
            letter-spacing: 0.5px;
        }
    }
}

// Dropdown separator line
component DropdownSeparator inherits Rectangle {
    height: 5px;
    
    Rectangle {
        y: 2px;
        height: 1px;
        x: 8px;
        width: parent.width - 16px;
        background: Theme.border-color;
    }
}

export component Ribbon inherits Rectangle {
    // Properties
    in property <string> current-tool: "select";
    in property <string> transform-mode: "world";
    in property <string> play-state: "stopped";
    in property <bool> has-unsaved-changes: false;
    
    // Panel visibility (bound from main)
    in-out property <bool> show-explorer: true;
    in-out property <bool> show-properties: true;
    in-out property <bool> show-output: true;
    in-out property <bool> show-assets: false;
    in-out property <bool> show-collaboration: false;
    in-out property <bool> show-command-bar: false;
    
    // File callbacks
    callback on-new-scene();
    callback on-open-scene();
    callback on-save-scene();
    callback on-save-scene-as();
    callback on-publish();
    callback on-publish-as();
    callback on-exit();
    
    // Edit callbacks
    callback on-undo();
    callback on-redo();
    callback on-copy();
    callback on-cut();
    callback on-paste();
    callback on-delete();
    callback on-duplicate();
    callback on-select-all();
    callback on-group();
    callback on-ungroup();
    
    // Tool callbacks
    callback on-select-tool(string);
    callback on-set-transform-mode(string);
    
    // Play callbacks
    callback on-play-solo();
    callback on-play-with-character();
    callback on-pause();
    callback on-stop();
    
    // View callbacks
    callback on-focus-selection();
    
    // Network callbacks
    callback on-start-server();
    callback on-stop-server();
    callback on-show-forge-connect();
    callback on-show-network-panel();
    callback on-show-stress-test();
    
    // Data callbacks
    callback on-show-global-sources();
    callback on-show-domains();
    callback on-show-global-variables();
    callback on-show-sync-domain();
    callback on-add-data-source(string);
    
    // Terrain callbacks
    callback on-spawn-terrain(string);
    callback on-toggle-terrain-edit();
    callback on-set-terrain-brush(string);
    callback on-import-heightmap();
    callback on-export-heightmap();
    
    // Plugin callbacks
    callback on-plugin-action(string);
    
    // Other callbacks
    callback on-toggle-command-bar();
    callback on-show-keybindings();
    callback on-show-soul-settings();
    callback on-open-url(string);
    callback on-menu-action(string);
    
    // Active ribbon tab: "home", "model", "ui", "terrain", "test", "mindspace"
    in-out property <string> ribbon-tab: "home";
    
    height: 118px;
    background: Theme.ribbon-background;
    
    // Bottom edge separator
    Rectangle {
        y: parent.height - 1px;
        width: 100%;
        height: 1px;
        background: Theme.border-color;
    }
    
    VerticalLayout {
        padding: 0px;
        spacing: 0px;
        
        // ── Menu bar row ──
        Rectangle {
            height: 24px;
            background: Theme.ribbon-background;
            
            HorizontalLayout {
                padding-left: 4px;
                padding-right: 4px;
                spacing: 0px;
                alignment: start;
                
                // ── FILE ──
                Rectangle {
                    width: self.preferred-width;
                    preferred-width: file-label.preferred-width + 12px;
                    background: file-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 2px;
                    
                    file-touch := TouchArea { clicked => { file-popup.show(); } }
                    file-label := Text { text: "File"; color: Theme.text-primary; font-size: 12px; horizontal-alignment: center; vertical-alignment: center; }
                    
                    file-popup := PopupWindow {
                        x: 0px;
                        y: parent.height;
                        width: 240px;
                        
                        Rectangle {
                            background: #1e1e1e;
                            border-radius: 4px;
                            border-width: 1px;
                            border-color: #3a3a3a;
                            drop-shadow-blur: 8px;
                            drop-shadow-color: #00000080;
                            width: 240px;
                            
                            VerticalLayout {
                                padding-top: 4px;
                                padding-bottom: 4px;
                                
                                DropdownItem { label: "New Scene"; shortcut: "Ctrl+N"; clicked => { root.on-new-scene(); } }
                                DropdownItem { label: "Open Scene..."; shortcut: "Ctrl+O"; clicked => { root.on-open-scene(); } }
                                DropdownItem { label: "Save Scene"; shortcut: "Ctrl+S"; clicked => { root.on-save-scene(); } }
                                DropdownItem { label: "Save As..."; shortcut: "Ctrl+Shift+S"; clicked => { root.on-save-scene-as(); } }
                                DropdownSeparator {}
                                DropdownItem { label: "Publish..."; shortcut: "Ctrl+P"; clicked => { root.on-publish(); } }
                                DropdownItem { label: "Publish As..."; clicked => { root.on-publish-as(); } }
                                DropdownSeparator {}
                                DropdownItem { label: "Keyboard Shortcuts..."; clicked => { root.on-show-keybindings(); } }
                                DropdownItem { label: "Soul Settings..."; clicked => { root.on-show-soul-settings(); } }
                                DropdownSeparator {}
                                DropdownItem { label: "Exit"; clicked => { root.on-exit(); } }
                            }
                        }
                    }
                }
                
                // ── EDIT ──
                Rectangle {
                    width: self.preferred-width;
                    preferred-width: edit-label.preferred-width + 12px;
                    background: edit-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 2px;
                    
                    edit-touch := TouchArea { clicked => { edit-popup.show(); } }
                    edit-label := Text { text: "Edit"; color: Theme.text-primary; font-size: 12px; horizontal-alignment: center; vertical-alignment: center; }
                    
                    edit-popup := PopupWindow {
                        x: 0px;
                        y: parent.height;
                        width: 220px;
                        
                        Rectangle {
                            background: #1e1e1e;
                            border-radius: 4px;
                            border-width: 1px;
                            border-color: #3a3a3a;
                            drop-shadow-blur: 8px;
                            drop-shadow-color: #00000080;
                            width: 220px;
                            
                            VerticalLayout {
                                padding-top: 4px;
                                padding-bottom: 4px;
                                
                                DropdownItem { label: "Undo"; shortcut: "Ctrl+Z"; clicked => { root.on-undo(); } }
                                DropdownItem { label: "Redo"; shortcut: "Ctrl+Y"; clicked => { root.on-redo(); } }
                                DropdownSeparator {}
                                DropdownItem { label: "Copy"; shortcut: "Ctrl+C"; clicked => { root.on-copy(); } }
                                DropdownItem { label: "Cut"; shortcut: "Ctrl+X"; clicked => { root.on-cut(); } }
                                DropdownItem { label: "Paste"; shortcut: "Ctrl+V"; clicked => { root.on-paste(); } }
                                DropdownItem { label: "Duplicate"; shortcut: "Ctrl+D"; clicked => { root.on-duplicate(); } }
                                DropdownItem { label: "Delete"; shortcut: "Del"; clicked => { root.on-delete(); } }
                                DropdownSeparator {}
                                DropdownItem { label: "Select All"; shortcut: "Ctrl+A"; clicked => { root.on-select-all(); } }
                                DropdownSeparator {}
                                DropdownItem { label: "Group"; shortcut: "Ctrl+G"; clicked => { root.on-group(); } }
                                DropdownItem { label: "Ungroup"; shortcut: "Ctrl+U"; clicked => { root.on-ungroup(); } }
                            }
                        }
                    }
                }
                
                // ── VIEW ──
                Rectangle {
                    width: self.preferred-width;
                    preferred-width: view-label.preferred-width + 12px;
                    background: view-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 2px;
                    
                    view-touch := TouchArea { clicked => { view-popup.show(); } }
                    view-label := Text { text: "View"; color: Theme.text-primary; font-size: 12px; horizontal-alignment: center; vertical-alignment: center; }
                    
                    view-popup := PopupWindow {
                        x: 0px;
                        y: parent.height;
                        width: 220px;
                        
                        Rectangle {
                            background: #1e1e1e;
                            border-radius: 4px;
                            border-width: 1px;
                            border-color: #3a3a3a;
                            drop-shadow-blur: 8px;
                            drop-shadow-color: #00000080;
                            width: 220px;
                            
                            VerticalLayout {
                                padding-top: 4px;
                                padding-bottom: 4px;
                                
                                DropdownHeader { label: "PANELS"; }
                                DropdownItem { label: root.show-explorer ? "Explorer  [on]" : "Explorer  [off]"; shortcut: "Ctrl+1"; clicked => { root.show-explorer = !root.show-explorer; } }
                                DropdownItem { label: root.show-properties ? "Properties  [on]" : "Properties  [off]"; shortcut: "Ctrl+2"; clicked => { root.show-properties = !root.show-properties; } }
                                DropdownItem { label: root.show-output ? "Output  [on]" : "Output  [off]"; shortcut: "Ctrl+3"; clicked => { root.show-output = !root.show-output; } }
                                DropdownItem { label: root.show-assets ? "Assets  [on]" : "Assets  [off]"; shortcut: "Ctrl+4"; clicked => { root.show-assets = !root.show-assets; } }
                                DropdownItem { label: root.show-collaboration ? "Collaborate  [on]" : "Collaborate  [off]"; shortcut: "Ctrl+5"; clicked => { root.show-collaboration = !root.show-collaboration; } }
                                DropdownItem { label: root.show-command-bar ? "Command Bar  [on]" : "Command Bar  [off]"; shortcut: "Ctrl+K"; clicked => { root.show-command-bar = !root.show-command-bar; } }
                                DropdownSeparator {}
                                DropdownHeader { label: "CAMERA"; }
                                DropdownItem { label: "Focus Selection"; shortcut: "F"; clicked => { root.on-focus-selection(); } }
                            }
                        }
                    }
                }
                
                // ── INSERT ──
                Rectangle {
                    width: self.preferred-width;
                    preferred-width: insert-label.preferred-width + 12px;
                    background: insert-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 2px;
                    
                    insert-touch := TouchArea { clicked => { insert-popup.show(); } }
                    insert-label := Text { text: "Insert"; color: Theme.text-primary; font-size: 12px; horizontal-alignment: center; vertical-alignment: center; }
                    
                    insert-popup := PopupWindow {
                        x: 0px;
                        y: parent.height;
                        width: 260px;
                        height: 600px;
                        
                        Rectangle {
                            background: #1e1e1e;
                            border-radius: 4px;
                            border-width: 1px;
                            border-color: #3a3a3a;
                            drop-shadow-blur: 8px;
                            drop-shadow-color: #00000080;
                            width: 260px;
                            height: 600px;
                            
                            ScrollView {
                                width: 100%;
                                height: 100%;
                                
                                VerticalLayout {
                                    padding-top: 4px;
                                    padding-bottom: 4px;
                                    width: 240px;
                                    
                                    DropdownHeader { label: "PRIMITIVES"; }
                                    DropdownItem { label: "Part (Block)"; clicked => { root.on-menu-action("insert:part"); } }
                                    DropdownItem { label: "Sphere"; clicked => { root.on-menu-action("insert:sphere"); } }
                                    DropdownItem { label: "Cylinder"; clicked => { root.on-menu-action("insert:cylinder"); } }
                                    DropdownItem { label: "Wedge"; clicked => { root.on-menu-action("insert:wedge"); } }
                                    DropdownItem { label: "MeshPart"; clicked => { root.on-menu-action("insert:meshpart"); } }
                                    DropdownItem { label: "UnionOperation"; clicked => { root.on-menu-action("insert:unionoperation"); } }
                                    DropdownSeparator {}
                                    DropdownHeader { label: "STRUCTURE"; }
                                    DropdownItem { label: "Model"; clicked => { root.on-menu-action("insert:model"); } }
                                    DropdownItem { label: "Folder"; clicked => { root.on-menu-action("insert:folder"); } }
                                    DropdownItem { label: "SpawnLocation"; clicked => { root.on-menu-action("insert:spawnlocation"); } }
                                    DropdownItem { label: "Seat"; clicked => { root.on-menu-action("insert:seat"); } }
                                    DropdownItem { label: "VehicleSeat"; clicked => { root.on-menu-action("insert:vehicleseat"); } }
                                    DropdownSeparator {}
                                    DropdownHeader { label: "SCRIPTING"; }
                                    DropdownItem { label: "Script"; clicked => { root.on-menu-action("insert:script"); } }
                                    DropdownItem { label: "LocalScript"; clicked => { root.on-menu-action("insert:localscript"); } }
                                    DropdownItem { label: "ModuleScript"; clicked => { root.on-menu-action("insert:modulescript"); } }
                                    DropdownSeparator {}
                                    DropdownHeader { label: "CONSTRAINTS"; }
                                    DropdownItem { label: "Attachment"; clicked => { root.on-menu-action("insert:attachment"); } }
                                    DropdownItem { label: "WeldConstraint"; clicked => { root.on-menu-action("insert:weldconstraint"); } }
                                    DropdownItem { label: "Motor6D"; clicked => { root.on-menu-action("insert:motor6d"); } }
                                    DropdownItem { label: "Beam"; clicked => { root.on-menu-action("insert:beam"); } }
                                    DropdownSeparator {}
                                    DropdownHeader { label: "EFFECTS"; }
                                    DropdownItem { label: "ParticleEmitter"; clicked => { root.on-menu-action("insert:particleemitter"); } }
                                    DropdownItem { label: "Decal"; clicked => { root.on-menu-action("insert:decal"); } }
                                    DropdownItem { label: "Sound"; clicked => { root.on-menu-action("insert:sound"); } }
                                    DropdownSeparator {}
                                    DropdownHeader { label: "LIGHTING"; }
                                    DropdownItem { label: "PointLight"; clicked => { root.on-menu-action("insert:pointlight"); } }
                                    DropdownItem { label: "SpotLight"; clicked => { root.on-menu-action("insert:spotlight"); } }
                                    DropdownItem { label: "SurfaceLight"; clicked => { root.on-menu-action("insert:surfacelight"); } }
                                    DropdownSeparator {}
                                    DropdownHeader { label: "UI - CONTAINERS"; }
                                    DropdownItem { label: "ScreenGui"; clicked => { root.on-menu-action("insert:screengui"); } }
                                    DropdownItem { label: "BillboardGui"; clicked => { root.on-menu-action("insert:billboardgui"); } }
                                    DropdownItem { label: "SurfaceGui"; clicked => { root.on-menu-action("insert:surfacegui"); } }
                                    DropdownItem { label: "Frame"; clicked => { root.on-menu-action("insert:frame"); } }
                                    DropdownItem { label: "ScrollingFrame"; clicked => { root.on-menu-action("insert:scrollingframe"); } }
                                    DropdownSeparator {}
                                    DropdownHeader { label: "UI - DISPLAY"; }
                                    DropdownItem { label: "TextLabel"; clicked => { root.on-menu-action("insert:textlabel"); } }
                                    DropdownItem { label: "ImageLabel"; clicked => { root.on-menu-action("insert:imagelabel"); } }
                                    DropdownSeparator {}
                                    DropdownHeader { label: "UI - INTERACTIVE"; }
                                    DropdownItem { label: "TextButton"; clicked => { root.on-menu-action("insert:textbutton"); } }
                                    DropdownItem { label: "ImageButton"; clicked => { root.on-menu-action("insert:imagebutton"); } }
                                    DropdownItem { label: "TextBox"; clicked => { root.on-menu-action("insert:textbox"); } }
                                    DropdownItem { label: "ViewportFrame"; clicked => { root.on-menu-action("insert:viewportframe"); } }
                                    DropdownItem { label: "VideoFrame"; clicked => { root.on-menu-action("insert:videoframe"); } }
                                    DropdownItem { label: "DocumentFrame"; clicked => { root.on-menu-action("insert:documentframe"); } }
                                    DropdownItem { label: "WebFrame"; clicked => { root.on-menu-action("insert:webframe"); } }
                                }
                            }
                        }
                    }
                }
                
                // ── MODEL ──
                Rectangle {
                    width: self.preferred-width;
                    preferred-width: model-label.preferred-width + 12px;
                    background: model-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 2px;
                    
                    model-touch := TouchArea { clicked => { model-popup.show(); } }
                    model-label := Text { text: "Model"; color: Theme.text-primary; font-size: 12px; horizontal-alignment: center; vertical-alignment: center; }
                    
                    model-popup := PopupWindow {
                        x: 0px;
                        y: parent.height;
                        width: 200px;
                        
                        Rectangle {
                            background: #1e1e1e;
                            border-radius: 4px;
                            border-width: 1px;
                            border-color: #3a3a3a;
                            drop-shadow-blur: 8px;
                            drop-shadow-color: #00000080;
                            width: 200px;
                            
                            VerticalLayout {
                                padding-top: 4px;
                                padding-bottom: 4px;
                                
                                DropdownItem { label: "Group"; shortcut: "Ctrl+G"; clicked => { root.on-group(); } }
                                DropdownItem { label: "Ungroup"; shortcut: "Ctrl+U"; clicked => { root.on-ungroup(); } }
                                DropdownSeparator {}
                                DropdownItem { label: "Union"; clicked => { root.on-menu-action("model:union"); } }
                                DropdownItem { label: "Negate"; clicked => { root.on-menu-action("model:negate"); } }
                                DropdownItem { label: "Separate"; clicked => { root.on-menu-action("model:separate"); } }
                            }
                        }
                    }
                }
                
                // ── TEST ──
                Rectangle {
                    width: self.preferred-width;
                    preferred-width: test-label.preferred-width + 12px;
                    background: test-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 2px;
                    
                    test-touch := TouchArea { clicked => { test-popup.show(); } }
                    test-label := Text { text: "Test"; color: Theme.text-primary; font-size: 12px; horizontal-alignment: center; vertical-alignment: center; }
                    
                    test-popup := PopupWindow {
                        x: 0px;
                        y: parent.height;
                        width: 200px;
                        
                        Rectangle {
                            background: #1e1e1e;
                            border-radius: 4px;
                            border-width: 1px;
                            border-color: #3a3a3a;
                            drop-shadow-blur: 8px;
                            drop-shadow-color: #00000080;
                            width: 200px;
                            
                            VerticalLayout {
                                padding-top: 4px;
                                padding-bottom: 4px;
                                
                                DropdownItem { label: "Run"; shortcut: "F7"; clicked => { root.on-play-solo(); } }
                                DropdownItem { label: "Play"; shortcut: "F5"; clicked => { root.on-play-with-character(); } }
                                DropdownItem { label: "Pause"; shortcut: "F6"; clicked => { root.on-pause(); } }
                                DropdownItem { label: "Stop"; shortcut: "F8"; clicked => { root.on-stop(); } }
                                DropdownSeparator {}
                                DropdownItem { label: "Stress Test..."; clicked => { root.on-show-stress-test(); } }
                            }
                        }
                    }
                }
                
                // ── PLUGINS ──
                Rectangle {
                    width: self.preferred-width;
                    preferred-width: plugins-label.preferred-width + 12px;
                    background: plugins-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 2px;
                    
                    plugins-touch := TouchArea { clicked => { plugins-popup.show(); } }
                    plugins-label := Text { text: "Plugins"; color: Theme.text-primary; font-size: 12px; horizontal-alignment: center; vertical-alignment: center; }
                    
                    plugins-popup := PopupWindow {
                        x: 0px;
                        y: parent.height;
                        width: 200px;
                        
                        Rectangle {
                            background: #1e1e1e;
                            border-radius: 4px;
                            border-width: 1px;
                            border-color: #3a3a3a;
                            drop-shadow-blur: 8px;
                            drop-shadow-color: #00000080;
                            width: 200px;
                            
                            VerticalLayout {
                                padding-top: 4px;
                                padding-bottom: 4px;
                                
                                DropdownItem { label: "View Plugins Folder"; clicked => { root.on-plugin-action("system:open-plugins-folder"); } }
                                DropdownItem { label: "Reload Plugins"; clicked => { root.on-plugin-action("system:reload-plugins"); } }
                                DropdownSeparator {}
                                DropdownHeader { label: "INSTALLED"; }
                                DropdownItem { label: "MindSpace"; clicked => { root.on-plugin-action("mindspace:toggle-panel"); } }
                                DropdownSeparator {}
                                DropdownItem { label: "Plugin Marketplace..."; clicked => { root.on-plugin-action("system:marketplace"); } }
                            }
                        }
                    }
                }
                
                // ── NETWORK ──
                Rectangle {
                    width: self.preferred-width;
                    preferred-width: network-label.preferred-width + 12px;
                    background: network-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 2px;
                    
                    network-touch := TouchArea { clicked => { network-popup.show(); } }
                    network-label := Text { text: "Network"; color: Theme.text-primary; font-size: 12px; horizontal-alignment: center; vertical-alignment: center; }
                    
                    network-popup := PopupWindow {
                        x: 0px;
                        y: parent.height;
                        width: 220px;
                        
                        Rectangle {
                            background: #1e1e1e;
                            border-radius: 4px;
                            border-width: 1px;
                            border-color: #3a3a3a;
                            drop-shadow-blur: 8px;
                            drop-shadow-color: #00000080;
                            width: 220px;
                            
                            VerticalLayout {
                                padding-top: 4px;
                                padding-bottom: 4px;
                                
                                DropdownHeader { label: "SERVER"; }
                                DropdownItem { label: "Start Local Server"; shortcut: "F9"; clicked => { root.on-start-server(); } }
                                DropdownItem { label: "Stop Server"; clicked => { root.on-stop-server(); } }
                                DropdownSeparator {}
                                DropdownHeader { label: "FORGE CLOUD"; }
                                DropdownItem { label: "Connect to Forge..."; clicked => { root.on-show-forge-connect(); } }
                                DropdownItem { label: "Allocate Server"; clicked => { root.on-plugin-action("network:forge-allocate"); } }
                                DropdownSeparator {}
                                DropdownHeader { label: "BENCHMARK"; }
                                DropdownItem { label: "Network Panel"; clicked => { root.on-show-network-panel(); } }
                                DropdownItem { label: "Start Stress Test..."; clicked => { root.on-show-stress-test(); } }
                            }
                        }
                    }
                }
                
                // ── DATA ──
                Rectangle {
                    width: self.preferred-width;
                    preferred-width: data-label.preferred-width + 12px;
                    background: data-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 2px;
                    
                    data-touch := TouchArea { clicked => { data-popup.show(); } }
                    data-label := Text { text: "Data"; color: Theme.text-primary; font-size: 12px; horizontal-alignment: center; vertical-alignment: center; }
                    
                    data-popup := PopupWindow {
                        x: 0px;
                        y: parent.height;
                        width: 220px;
                        
                        Rectangle {
                            background: #1e1e1e;
                            border-radius: 4px;
                            border-width: 1px;
                            border-color: #3a3a3a;
                            drop-shadow-blur: 8px;
                            drop-shadow-color: #00000080;
                            width: 220px;
                            
                            VerticalLayout {
                                padding-top: 4px;
                                padding-bottom: 4px;
                                
                                DropdownHeader { label: "CONFIGURATION"; }
                                DropdownItem { label: "Manage Global Sources..."; clicked => { root.on-show-global-sources(); } }
                                DropdownItem { label: "Manage Domains..."; clicked => { root.on-show-domains(); } }
                                DropdownItem { label: "Global Variables..."; clicked => { root.on-show-global-variables(); } }
                                DropdownSeparator {}
                                DropdownHeader { label: "SYNC"; }
                                DropdownItem { label: "Sync Domain to Object Type..."; clicked => { root.on-show-sync-domain(); } }
                                DropdownSeparator {}
                                DropdownHeader { label: "QUICK ADD SOURCE"; }
                                DropdownItem { label: "HTTP / REST API"; clicked => { root.on-add-data-source("REST"); } }
                                DropdownItem { label: "GraphQL"; clicked => { root.on-add-data-source("GraphQL"); } }
                                DropdownItem { label: "PostgreSQL"; clicked => { root.on-add-data-source("PostgreSQL"); } }
                                DropdownItem { label: "CSV / Excel File"; clicked => { root.on-add-data-source("CSV"); } }
                                DropdownSeparator {}
                                DropdownHeader { label: "CLOUD PROVIDERS"; }
                                DropdownItem { label: "Firebase"; clicked => { root.on-add-data-source("Firebase"); } }
                                DropdownItem { label: "Supabase"; clicked => { root.on-add-data-source("Supabase"); } }
                                DropdownItem { label: "AWS S3"; clicked => { root.on-add-data-source("S3"); } }
                                DropdownItem { label: "Azure Blob"; clicked => { root.on-add-data-source("AzureBlob"); } }
                                DropdownItem { label: "Oracle Cloud"; clicked => { root.on-add-data-source("Oracle"); } }
                            }
                        }
                    }
                }
                
                // ── TERRAIN ──
                Rectangle {
                    width: self.preferred-width;
                    preferred-width: terrain-label.preferred-width + 12px;
                    background: terrain-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 2px;
                    
                    terrain-touch := TouchArea { clicked => { terrain-popup.show(); } }
                    terrain-label := Text { text: "Terrain"; color: Theme.text-primary; font-size: 12px; horizontal-alignment: center; vertical-alignment: center; }
                    
                    terrain-popup := PopupWindow {
                        x: 0px;
                        y: parent.height;
                        width: 200px;
                        
                        Rectangle {
                            background: #1e1e1e;
                            border-radius: 4px;
                            border-width: 1px;
                            border-color: #3a3a3a;
                            drop-shadow-blur: 8px;
                            drop-shadow-color: #00000080;
                            width: 200px;
                            
                            VerticalLayout {
                                padding-top: 4px;
                                padding-bottom: 4px;
                                
                                DropdownHeader { label: "GENERATE"; }
                                DropdownItem { label: "Small (128m)"; clicked => { root.on-spawn-terrain("small"); } }
                                DropdownItem { label: "Medium (512m)"; clicked => { root.on-spawn-terrain("medium"); } }
                                DropdownItem { label: "Large (2km)"; clicked => { root.on-spawn-terrain("large"); } }
                                DropdownSeparator {}
                                DropdownItem { label: "Toggle Edit Mode"; shortcut: "T"; clicked => { root.on-toggle-terrain-edit(); } }
                                DropdownSeparator {}
                                DropdownHeader { label: "BRUSH TOOLS"; }
                                DropdownItem { label: "Raise"; shortcut: "1"; clicked => { root.on-set-terrain-brush("raise"); } }
                                DropdownItem { label: "Lower"; shortcut: "2"; clicked => { root.on-set-terrain-brush("lower"); } }
                                DropdownItem { label: "Smooth"; shortcut: "3"; clicked => { root.on-set-terrain-brush("smooth"); } }
                                DropdownItem { label: "Flatten"; shortcut: "4"; clicked => { root.on-set-terrain-brush("flatten"); } }
                                DropdownItem { label: "Paint"; shortcut: "5"; clicked => { root.on-set-terrain-brush("paint"); } }
                                DropdownSeparator {}
                                DropdownHeader { label: "ASSETS"; }
                                DropdownItem { label: "Import Heightmap..."; clicked => { root.on-import-heightmap(); } }
                                DropdownItem { label: "Export Heightmap..."; clicked => { root.on-export-heightmap(); } }
                            }
                        }
                    }
                }
                
                // ── MINDSPACE ──
                Rectangle {
                    width: self.preferred-width;
                    preferred-width: mindspace-label.preferred-width + 12px;
                    background: mindspace-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 2px;
                    
                    mindspace-touch := TouchArea { clicked => { mindspace-popup.show(); } }
                    mindspace-label := Text { text: "MindSpace"; color: Theme.text-primary; font-size: 12px; horizontal-alignment: center; vertical-alignment: center; }
                    
                    mindspace-popup := PopupWindow {
                        x: 0px;
                        y: parent.height;
                        width: 220px;
                        
                        Rectangle {
                            background: #1e1e1e;
                            border-radius: 4px;
                            border-width: 1px;
                            border-color: #3a3a3a;
                            drop-shadow-blur: 8px;
                            drop-shadow-color: #00000080;
                            width: 220px;
                            
                            VerticalLayout {
                                padding-top: 4px;
                                padding-bottom: 4px;
                                
                                DropdownHeader { label: "PANEL"; }
                                DropdownItem { label: "Toggle Panel"; shortcut: "Ctrl+M"; clicked => { root.on-plugin-action("mindspace:toggle-panel"); } }
                                DropdownSeparator {}
                                DropdownHeader { label: "LABELS"; }
                                DropdownItem { label: "Add Label"; shortcut: "Ctrl+L"; clicked => { root.on-plugin-action("mindspace:add-label"); } }
                                DropdownItem { label: "Remove Label"; clicked => { root.on-plugin-action("mindspace:remove-label"); } }
                                DropdownSeparator {}
                                DropdownHeader { label: "CONNECTIONS"; }
                                DropdownItem { label: "Connect Nodes"; shortcut: "Ctrl+K"; clicked => { root.on-plugin-action("mindspace:connect"); } }
                                DropdownItem { label: "Search"; shortcut: "Ctrl+F"; clicked => { root.on-plugin-action("mindspace:search"); } }
                                DropdownSeparator {}
                                DropdownHeader { label: "FILE"; }
                                DropdownItem { label: "New Mind Map"; clicked => { root.on-plugin-action("mindspace:new"); } }
                                DropdownItem { label: "Export..."; clicked => { root.on-plugin-action("mindspace:export"); } }
                                DropdownItem { label: "Import..."; clicked => { root.on-plugin-action("mindspace:import"); } }
                                DropdownSeparator {}
                                DropdownHeader { label: "AI TOOLS"; }
                                DropdownItem { label: "AI Suggestions"; clicked => { root.on-plugin-action("mindspace:ai-suggest"); } }
                                DropdownItem { label: "Auto Layout"; clicked => { root.on-plugin-action("mindspace:ai-layout"); } }
                                DropdownItem { label: "Generate Summary"; clicked => { root.on-plugin-action("mindspace:ai-summarize"); } }
                            }
                        }
                    }
                }
                
                // ── HELP ──
                Rectangle {
                    width: self.preferred-width;
                    preferred-width: help-label.preferred-width + 12px;
                    background: help-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 2px;
                    
                    help-touch := TouchArea { clicked => { help-popup.show(); } }
                    help-label := Text { text: "Help"; color: Theme.text-primary; font-size: 12px; horizontal-alignment: center; vertical-alignment: center; }
                    
                    help-popup := PopupWindow {
                        x: 0px;
                        y: parent.height;
                        width: 200px;
                        
                        Rectangle {
                            background: #1e1e1e;
                            border-radius: 4px;
                            border-width: 1px;
                            border-color: #3a3a3a;
                            drop-shadow-blur: 8px;
                            drop-shadow-color: #00000080;
                            width: 200px;
                            
                            VerticalLayout {
                                padding-top: 4px;
                                padding-bottom: 4px;
                                
                                DropdownHeader { label: "DOCUMENTATION"; }
                                DropdownItem { label: "Documentation"; clicked => { root.on-open-url("https://docs.eustress.dev"); } }
                                DropdownItem { label: "API Reference"; clicked => { root.on-open-url("https://docs.eustress.dev/api"); } }
                                DropdownItem { label: "Tutorials"; clicked => { root.on-open-url("https://docs.eustress.dev/tutorials"); } }
                                DropdownItem { label: "Soul Scripting Guide"; clicked => { root.on-open-url("https://docs.eustress.dev/soul"); } }
                                DropdownSeparator {}
                                DropdownHeader { label: "COMMUNITY"; }
                                DropdownItem { label: "Website"; clicked => { root.on-open-url("https://eustress.dev"); } }
                                DropdownItem { label: "Discord"; clicked => { root.on-open-url("https://discord.gg/eustress"); } }
                                DropdownItem { label: "GitHub"; clicked => { root.on-open-url("https://github.com/eustressengine/eustress"); } }
                                DropdownSeparator {}
                                DropdownItem { label: "About Eustress Engine"; clicked => { root.on-menu-action("help:about"); } }
                            }
                        }
                    }
                }
                
                Rectangle { horizontal-stretch: 1; }
                
                // Unsaved indicator
                if root.has-unsaved-changes: Rectangle {
                    width: 70px;
                    
                    Text {
                        text: "Unsaved";
                        color: Theme.text-warning;
                        font-size: 10px;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                }
            }
        }
        
        // ── Ribbon tab selector row ──
        Rectangle {
            height: 22px;
            background: Theme.ribbon-background;
            
            // Simulation controls — absolute left
            HorizontalLayout {
                x: 6px;
                y: 1px;
                width: 112px;
                height: 20px;
                spacing: 2px;
                
                // Play (Run solo)
                Rectangle {
                    width: 26px;
                    height: 20px;
                    background: root.play-state == "playing" ? Theme.accent-green : 
                                play-solo-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 3px;
                    
                    play-solo-touch := TouchArea {
                        mouse-cursor: pointer;
                        clicked => { if root.play-state == "stopped" { root.on-play-solo(); } }
                    }
                    Image {
                        x: 5px; y: 2px; width: 16px; height: 16px;
                        source: @image-url("../../assets/icons/ui/play.svg");
                        image-fit: contain; colorize: #66bb6a;
                    }
                }
                // Play Here with Character
                Rectangle {
                    width: 26px;
                    height: 20px;
                    background: play-char-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 3px;
                    
                    play-char-touch := TouchArea {
                        mouse-cursor: pointer;
                        clicked => { if root.play-state == "stopped" { root.on-play-with-character(); } }
                    }
                    Image {
                        x: 5px; y: 2px; width: 16px; height: 16px;
                        source: @image-url("../../assets/icons/ui/gamepad.svg");
                        image-fit: contain; colorize: #66bb6a;
                    }
                }
                // Pause
                Rectangle {
                    width: 26px;
                    height: 20px;
                    background: root.play-state == "paused" ? Theme.accent-yellow :
                                pause-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 3px;
                    
                    pause-touch := TouchArea {
                        mouse-cursor: pointer;
                        clicked => { if root.play-state == "playing" { root.on-pause(); } }
                    }
                    Image {
                        x: 5px; y: 2px; width: 16px; height: 16px;
                        source: @image-url("../../assets/icons/ui/pause.svg");
                        image-fit: contain; colorize: #ffb74d;
                    }
                }
                // Stop
                Rectangle {
                    width: 26px;
                    height: 20px;
                    background: stop-touch.has-hover ? Theme.button-hover : transparent;
                    border-radius: 3px;
                    
                    stop-touch := TouchArea {
                        mouse-cursor: pointer;
                        clicked => { if root.play-state != "stopped" { root.on-stop(); } }
                    }
                    Image {
                        x: 5px; y: 2px; width: 16px; height: 16px;
                        source: @image-url("../../assets/icons/ui/stop.svg");
                        image-fit: contain; colorize: #ef5350;
                    }
                }
            }
            
            // Tab pills — absolute centered in full row width
            tabs-row := HorizontalLayout {
                x: (parent.width - self.preferred-width) / 2;
                y: 1px;
                width: self.preferred-width;
                height: 20px;
                spacing: 6px;
                
                for tab-item in [
                    { name: "Home",      id: "home",      color: #4686b4 },
                    { name: "Model",     id: "model",     color: #6495ed },
                    { name: "UI",        id: "ui",        color: #9370db },
                    { name: "Terrain",   id: "terrain",   color: #3cb371 },
                    { name: "Test",      id: "test",      color: #ff8c00 },
                    { name: "MindSpace", id: "mindspace", color: #7b68ee },
                ] : Rectangle {
                    width: tab-text.preferred-width + 16px;
                    height: 20px;
                    border-radius: 4px;
                    background: root.ribbon-tab == tab-item.id ? tab-item.color : 
                                tab-touch.has-hover ? Theme.button-hover : transparent;
                    
                    tab-touch := TouchArea {
                        mouse-cursor: pointer;
                        clicked => { root.ribbon-tab = tab-item.id; }
                    }
                    
                    tab-text := Text {
                        text: tab-item.name;
                        color: root.ribbon-tab == tab-item.id ? #ffffff : Theme.text-secondary;
                        font-size: 11px;
                        font-weight: root.ribbon-tab == tab-item.id ? 600 : 400;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                }
            }
        }
        
        // ── Toolbar content area — switches based on active ribbon tab ──
        Rectangle {
            height: 72px;
            background: Theme.ribbon-background;
            
            // ════════════════════════════════════════════════════════════
            // HOME TAB — File, History, Clipboard, Tools, Space, Utils
            // ════════════════════════════════════════════════════════════
            if root.ribbon-tab == "home": HorizontalLayout {
                padding-left: 6px;
                padding-right: 6px;
                spacing: 6px;
                alignment: start;
                
                // ── FILE group ──
                ToolGroup {
                    label: "File";
                    IconButton { icon: @image-url("../../assets/icons/ui/new-file.svg"); label: "New"; tooltip: "New Scene (Ctrl+N)"; tint: #64b5f6; clicked => { root.on-new-scene(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/import.svg"); label: "Open"; tooltip: "Open Scene (Ctrl+O)"; tint: #64b5f6; clicked => { root.on-open-scene(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/save.svg"); label: "Save"; tooltip: "Save Scene (Ctrl+S)"; tint: #64b5f6; clicked => { root.on-save-scene(); } }
                }
                GroupDivider {}
                
                // ── HISTORY group ──
                ToolGroup {
                    label: "History";
                    IconButton { icon: @image-url("../../assets/icons/ui/undo.svg"); label: "Undo"; tooltip: "Undo (Ctrl+Z)"; tint: #ffb74d; clicked => { root.on-undo(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/redo.svg"); label: "Redo"; tooltip: "Redo (Ctrl+Y)"; tint: #ffb74d; clicked => { root.on-redo(); } }
                }
                GroupDivider {}
                
                // ── CLIPBOARD group ──
                ToolGroup {
                    label: "Clipboard";
                    IconButton { icon: @image-url("../../assets/icons/ui/cut.svg"); label: "Cut"; tooltip: "Cut (Ctrl+X)"; tint: #4dd0e1; clicked => { root.on-cut(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/copy.svg"); label: "Copy"; tooltip: "Copy (Ctrl+C)"; tint: #4dd0e1; clicked => { root.on-copy(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/paste.svg"); label: "Paste"; tooltip: "Paste (Ctrl+V)"; tint: #4dd0e1; clicked => { root.on-paste(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/duplicate.svg"); label: "Duplicate"; tooltip: "Duplicate (Ctrl+D)"; tint: #81c784; clicked => { root.on-duplicate(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/delete.svg"); label: "Delete"; tooltip: "Delete (Del)"; tint: #ef5350; clicked => { root.on-delete(); } }
                }
                GroupDivider {}
                
                // ── TOOLS group ──
                ToolGroup {
                    label: "Tools";
                    IconButton { icon: @image-url("../../assets/icons/ui/cursor.svg"); label: "Select"; tooltip: "Select (Q)"; tint: #e0e0e0; selected: root.current-tool == "select"; clicked => { root.on-select-tool("select"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/move.svg"); label: "Move"; tooltip: "Move (W)"; tint: #66bb6a; selected: root.current-tool == "move"; clicked => { root.on-select-tool("move"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/scale.svg"); label: "Scale"; tooltip: "Scale (E)"; tint: #fdd835; selected: root.current-tool == "scale"; clicked => { root.on-select-tool("scale"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/rotate.svg"); label: "Rotate"; tooltip: "Rotate (R)"; tint: #42a5f5; selected: root.current-tool == "rotate"; clicked => { root.on-select-tool("rotate"); } }
                }
                GroupDivider {}
                
                // ── SPACE group — World/Local toggle ──
                ToolGroup {
                    label: "Space";
                    Rectangle {
                        width: 72px; height: 24px;
                        background: Theme.input-background; border-radius: 3px; border-width: 1px; border-color: Theme.input-border;
                        HorizontalLayout {
                            padding: 2px; spacing: 1px;
                            Rectangle {
                                horizontal-stretch: 1;
                                background: root.transform-mode == "world" ? Theme.selection-background : transparent;
                                border-radius: 2px;
                                TouchArea { clicked => { root.on-set-transform-mode("world"); } }
                                Text { text: "World"; color: root.transform-mode == "world" ? Theme.text-primary : Theme.text-secondary; font-size: 10px; horizontal-alignment: center; vertical-alignment: center; }
                            }
                            Rectangle {
                                horizontal-stretch: 1;
                                background: root.transform-mode == "local" ? Theme.selection-background : transparent;
                                border-radius: 2px;
                                TouchArea { clicked => { root.on-set-transform-mode("local"); } }
                                Text { text: "Local"; color: root.transform-mode == "local" ? Theme.text-primary : Theme.text-secondary; font-size: 10px; horizontal-alignment: center; vertical-alignment: center; }
                            }
                        }
                    }
                }
                GroupDivider {}
                
                // ── EDIT group ──
                ToolGroup {
                    label: "Edit";
                    IconButton { icon: @image-url("../../assets/icons/ui/group.svg"); label: "Group"; tooltip: "Group (Ctrl+G)"; tint: #90caf9; clicked => { root.on-group(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/ungroup.svg"); label: "Ungroup"; tooltip: "Ungroup (Ctrl+U)"; tint: #90caf9; clicked => { root.on-ungroup(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/lock.svg"); label: "Lock"; tooltip: "Lock"; tint: #ffcc80; clicked => { root.on-menu-action("edit:lock"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/unlock.svg"); label: "Unlock"; tooltip: "Unlock"; tint: #ffcc80; clicked => { root.on-menu-action("edit:unlock"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/anchor.svg"); label: "Anchor"; tooltip: "Toggle Anchor"; tint: #ce93d8; clicked => { root.on-menu-action("edit:anchor"); } }
                }
                
                Rectangle { horizontal-stretch: 1; }
                
                // ── UTILS group — right-aligned ──
                ToolGroup {
                    label: "Utils";
                    IconButton { icon: @image-url("../../assets/icons/ui/keyboard.svg"); label: "Keys"; tooltip: "Keyboard Shortcuts"; tint: #b39ddb; clicked => { root.on-show-keybindings(); } }
                    IconButton { icon: @image-url("../../assets/icons/soulservice.svg"); label: "Soul"; tooltip: "Soul Settings"; tint: #b39ddb; clicked => { root.on-show-soul-settings(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/terminal.svg"); label: "Console"; tooltip: "Command Palette (Ctrl+Shift+P)"; tint: #b39ddb; clicked => { root.on-toggle-command-bar(); } }
                }
            }
            
            // ════════════════════════════════════════════════════════════
            // MODEL TAB — Parts, Structure, Constraints, Effects, CSG, Assets
            // ════════════════════════════════════════════════════════════
            if root.ribbon-tab == "model": HorizontalLayout {
                padding-left: 6px;
                padding-right: 6px;
                spacing: 6px;
                alignment: start;
                
                ToolGroup {
                    label: "Parts";
                    IconButton { icon: @image-url("../../assets/icons/part.svg"); label: "Part"; tooltip: "Insert Part"; tint: #64b5f6; clicked => { root.on-menu-action("insert:part"); } }
                    IconButton { icon: @image-url("../../assets/icons/meshpart.svg"); label: "Mesh"; tooltip: "Insert MeshPart"; tint: #64b5f6; clicked => { root.on-menu-action("insert:meshpart"); } }
                    IconButton { icon: @image-url("../../assets/icons/unionoperation.svg"); label: "Union"; tooltip: "Insert Union"; tint: #64b5f6; clicked => { root.on-menu-action("insert:unionoperation"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/seat.svg"); label: "Seat"; tooltip: "Insert Seat"; tint: #64b5f6; clicked => { root.on-menu-action("insert:seat"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/vehicle.svg"); label: "Vehicle"; tooltip: "Insert VehicleSeat"; tint: #64b5f6; clicked => { root.on-menu-action("insert:vehicleseat"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Structure";
                    IconButton { icon: @image-url("../../assets/icons/model.svg"); label: "Model"; tooltip: "Insert Model"; tint: #81c784; clicked => { root.on-menu-action("insert:model"); } }
                    IconButton { icon: @image-url("../../assets/icons/folder.svg"); label: "Folder"; tooltip: "Insert Folder"; tint: #81c784; clicked => { root.on-menu-action("insert:folder"); } }
                    IconButton { icon: @image-url("../../assets/icons/spawnlocation.svg"); label: "Spawn"; tooltip: "Insert SpawnLocation"; tint: #81c784; clicked => { root.on-menu-action("insert:spawnlocation"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Constraints";
                    IconButton { icon: @image-url("../../assets/icons/attachment.svg"); label: "Attach"; tooltip: "Insert Attachment"; tint: #ffb74d; clicked => { root.on-menu-action("insert:attachment"); } }
                    IconButton { icon: @image-url("../../assets/icons/weldconstraint.svg"); label: "Weld"; tooltip: "Insert Weld"; tint: #ffb74d; clicked => { root.on-menu-action("insert:weldconstraint"); } }
                    IconButton { icon: @image-url("../../assets/icons/motor6d.svg"); label: "Motor"; tooltip: "Insert Motor6D"; tint: #ffb74d; clicked => { root.on-menu-action("insert:motor6d"); } }
                    IconButton { icon: @image-url("../../assets/icons/beam.svg"); label: "Beam"; tooltip: "Insert Beam"; tint: #ffb74d; clicked => { root.on-menu-action("insert:beam"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Effects";
                    IconButton { icon: @image-url("../../assets/icons/particleemitter.svg"); label: "Particles"; tooltip: "Insert Particles"; tint: #f48fb1; clicked => { root.on-menu-action("insert:particleemitter"); } }
                    IconButton { icon: @image-url("../../assets/icons/pointlight.svg"); label: "Point"; tooltip: "Insert PointLight"; tint: #fff176; clicked => { root.on-menu-action("insert:pointlight"); } }
                    IconButton { icon: @image-url("../../assets/icons/spotlight.svg"); label: "Spot"; tooltip: "Insert SpotLight"; tint: #fff176; clicked => { root.on-menu-action("insert:spotlight"); } }
                    IconButton { icon: @image-url("../../assets/icons/sound.svg"); label: "Sound"; tooltip: "Insert Sound"; tint: #80deea; clicked => { root.on-menu-action("insert:sound"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "CSG";
                    IconButton { icon: @image-url("../../assets/icons/ui/negate.svg"); label: "Negate"; tooltip: "Negate (CSG Subtract)"; tint: #ef9a9a; clicked => { root.on-menu-action("model:negate"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/intersect.svg"); label: "Intersect"; tooltip: "Intersect (CSG)"; tint: #a5d6a7; clicked => { root.on-menu-action("model:intersect"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/separate.svg"); label: "Separate"; tooltip: "Separate Union"; tint: #90caf9; clicked => { root.on-menu-action("model:separate"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Assets";
                    IconButton { icon: @image-url("../../assets/icons/ui/import.svg"); label: "Import"; tooltip: "Import Model (OBJ/FBX/GLTF)"; tint: #4dd0e1; clicked => { root.on-menu-action("model:import"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/export.svg"); label: "Export"; tooltip: "Export Selection"; tint: #4dd0e1; clicked => { root.on-menu-action("model:export"); } }
                }
            }
            
            // ════════════════════════════════════════════════════════════
            // UI TAB — Containers, Display, Interactive, Layout
            // ════════════════════════════════════════════════════════════
            if root.ribbon-tab == "ui": HorizontalLayout {
                padding-left: 6px;
                padding-right: 6px;
                spacing: 6px;
                alignment: start;
                
                ToolGroup {
                    label: "Containers";
                    IconButton { icon: @image-url("../../assets/icons/ui/screen.svg"); label: "Screen"; tooltip: "ScreenGui"; tint: #9575cd; clicked => { root.on-menu-action("insert:screengui"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/billboard.svg"); label: "Billboard"; tooltip: "BillboardGui"; tint: #9575cd; clicked => { root.on-menu-action("insert:billboardgui"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/surface.svg"); label: "Surface"; tooltip: "SurfaceGui"; tint: #9575cd; clicked => { root.on-menu-action("insert:surfacegui"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/frame.svg"); label: "Frame"; tooltip: "Frame"; tint: #9575cd; clicked => { root.on-menu-action("insert:frame"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/scroll.svg"); label: "Scroll"; tooltip: "ScrollingFrame"; tint: #9575cd; clicked => { root.on-menu-action("insert:scrollingframe"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Display";
                    IconButton { icon: @image-url("../../assets/icons/ui/text.svg"); label: "Text"; tooltip: "TextLabel"; tint: #80cbc4; clicked => { root.on-menu-action("insert:textlabel"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/image.svg"); label: "Image"; tooltip: "ImageLabel"; tint: #80cbc4; clicked => { root.on-menu-action("insert:imagelabel"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Interactive";
                    IconButton { icon: @image-url("../../assets/icons/ui/button.svg"); label: "Button"; tooltip: "TextButton"; tint: #ffab91; clicked => { root.on-menu-action("insert:textbutton"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/image.svg"); label: "ImgBtn"; tooltip: "ImageButton"; tint: #ffab91; clicked => { root.on-menu-action("insert:imagebutton"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/textbox.svg"); label: "TextBox"; tooltip: "TextBox"; tint: #ffab91; clicked => { root.on-menu-action("insert:textbox"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/viewport.svg"); label: "Viewport"; tooltip: "ViewportFrame"; tint: #a5d6a7; clicked => { root.on-menu-action("insert:viewportframe"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/video.svg"); label: "Video"; tooltip: "VideoFrame"; tint: #a5d6a7; clicked => { root.on-menu-action("insert:videoframe"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/document.svg"); label: "Doc"; tooltip: "DocumentFrame"; tint: #a5d6a7; clicked => { root.on-menu-action("insert:documentframe"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/web.svg"); label: "Web"; tooltip: "WebFrame"; tint: #a5d6a7; clicked => { root.on-menu-action("insert:webframe"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Layout";
                    IconButton { icon: @image-url("../../assets/icons/ui/align-left.svg"); label: "Left"; tooltip: "Align Left"; tint: #b0bec5; clicked => { root.on-menu-action("ui:align-left"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/align-center.svg"); label: "Center"; tooltip: "Align Center"; tint: #b0bec5; clicked => { root.on-menu-action("ui:align-center"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/align-right.svg"); label: "Right"; tooltip: "Align Right"; tint: #b0bec5; clicked => { root.on-menu-action("ui:align-right"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/distribute.svg"); label: "Distribute"; tooltip: "Distribute Evenly"; tint: #b0bec5; clicked => { root.on-menu-action("ui:distribute"); } }
                }
            }
            
            // ════════════════════════════════════════════════════════════
            // TERRAIN TAB — Generate, Edit, Brushes, Water, Assets
            // ════════════════════════════════════════════════════════════
            if root.ribbon-tab == "terrain": HorizontalLayout {
                padding-left: 6px;
                padding-right: 6px;
                spacing: 6px;
                alignment: start;
                
                ToolGroup {
                    label: "Generate";
                    IconButton { icon: @image-url("../../assets/icons/terrain.svg"); label: "Small"; tooltip: "Small Terrain (128m)"; tint: #66bb6a; clicked => { root.on-spawn-terrain("small"); } }
                    IconButton { icon: @image-url("../../assets/icons/terrain.svg"); label: "Medium"; tooltip: "Medium Terrain (512m)"; tint: #43a047; clicked => { root.on-spawn-terrain("medium"); } }
                    IconButton { icon: @image-url("../../assets/icons/terrain.svg"); label: "Large"; tooltip: "Large Terrain (2km)"; tint: #2e7d32; clicked => { root.on-spawn-terrain("large"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Edit";
                    IconButton { icon: @image-url("../../assets/icons/ui/check.svg"); label: "Edit"; tooltip: "Toggle Edit Mode (T)"; tint: #fdd835; clicked => { root.on-toggle-terrain-edit(); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Brushes";
                    IconButton { icon: @image-url("../../assets/icons/ui/chevron-up.svg"); label: "Raise"; tooltip: "Raise (1)"; tint: #81c784; clicked => { root.on-set-terrain-brush("raise"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/chevron-down.svg"); label: "Lower"; tooltip: "Lower (2)"; tint: #e57373; clicked => { root.on-set-terrain-brush("lower"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/filter.svg"); label: "Smooth"; tooltip: "Smooth (3)"; tint: #64b5f6; clicked => { root.on-set-terrain-brush("smooth"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/reset.svg"); label: "Flatten"; tooltip: "Flatten (4)"; tint: #ffb74d; clicked => { root.on-set-terrain-brush("flatten"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/palette.svg"); label: "Paint"; tooltip: "Paint (5)"; tint: #ce93d8; clicked => { root.on-set-terrain-brush("paint"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/frame.svg"); label: "Region"; tooltip: "Region"; tint: #90caf9; clicked => { root.on-set-terrain-brush("region"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/palette.svg"); label: "Fill"; tooltip: "Fill"; tint: #a5d6a7; clicked => { root.on-set-terrain-brush("fill"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Water";
                    IconButton { icon: @image-url("../../assets/icons/ui/water.svg"); label: "Water"; tooltip: "Set Sea Level"; tint: #4fc3f7; clicked => { root.on-menu-action("terrain:water"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Assets";
                    IconButton { icon: @image-url("../../assets/icons/ui/import.svg"); label: "Import"; tooltip: "Import Heightmap"; tint: #4dd0e1; clicked => { root.on-import-heightmap(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/export.svg"); label: "Export"; tooltip: "Export Heightmap"; tint: #4dd0e1; clicked => { root.on-export-heightmap(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/delete.svg"); label: "Clear"; tooltip: "Clear Terrain"; tint: #ef5350; clicked => { root.on-menu-action("terrain:clear"); } }
                }
            }
            
            // ════════════════════════════════════════════════════════════
            // TEST TAB — Server, Clients, Play, Network, Benchmark, Debug
            // ════════════════════════════════════════════════════════════
            if root.ribbon-tab == "test": HorizontalLayout {
                padding-left: 6px;
                padding-right: 6px;
                spacing: 6px;
                alignment: start;
                
                ToolGroup {
                    label: "Server";
                    IconButton { icon: @image-url("../../assets/icons/ui/server.svg"); label: "Start"; tooltip: "Start Server (F9)"; tint: #66bb6a; clicked => { root.on-start-server(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/close.svg"); label: "Stop"; tooltip: "Stop Server"; tint: #ef5350; clicked => { root.on-stop-server(); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Clients";
                    IconButton { icon: @image-url("../../assets/icons/ui/client.svg"); label: "Spawn"; tooltip: "Spawn Synthetic Clients"; tint: #64b5f6; clicked => { root.on-plugin-action("network:spawn-clients"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/close.svg"); label: "Disconnect"; tooltip: "Disconnect All"; tint: #ef9a9a; clicked => { root.on-plugin-action("network:disconnect-all"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Play";
                    IconButton { icon: @image-url("../../assets/icons/ui/gamepad.svg"); label: "Play"; tooltip: "Play Here"; tint: #66bb6a; clicked => { root.on-play-with-character(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/pause.svg"); label: "Pause"; tooltip: "Pause"; tint: #ffb74d; clicked => { root.on-pause(); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Network";
                    IconButton { icon: @image-url("../../assets/icons/ui/server.svg"); label: "Server"; tooltip: "Dedicated Server"; tint: #90caf9; clicked => { root.on-start-server(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/client.svg"); label: "Client"; tooltip: "Join as Client"; tint: #90caf9; clicked => { root.on-menu-action("test:join-client"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/network.svg"); label: "Local"; tooltip: "Local Server + Client"; tint: #90caf9; clicked => { root.on-menu-action("test:local"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Benchmark";
                    IconButton { icon: @image-url("../../assets/icons/ui/network.svg"); label: "Network"; tooltip: "Network Panel"; tint: #ffcc80; clicked => { root.on-show-network-panel(); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/stress.svg"); label: "Stress"; tooltip: "Stress Test"; tint: #ffcc80; clicked => { root.on-show-stress-test(); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Debug";
                    IconButton { icon: @image-url("../../assets/icons/ui/terminal.svg"); label: "Output"; tooltip: "Output Console"; tint: #b0bec5; clicked => { root.on-menu-action("test:console"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/debug.svg"); label: "Debug"; tooltip: "Debug Mode"; tint: #b0bec5; clicked => { root.on-menu-action("test:debug"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/cleanup.svg"); label: "Reset"; tooltip: "Reset Simulation"; tint: #ef5350; clicked => { root.on-stop(); } }
                }
            }
            
            // ════════════════════════════════════════════════════════════
            // MINDSPACE TAB — Panel, Labels, Connect, File, AI Tools
            // ════════════════════════════════════════════════════════════
            if root.ribbon-tab == "mindspace": HorizontalLayout {
                padding-left: 6px;
                padding-right: 6px;
                spacing: 6px;
                alignment: start;
                
                ToolGroup {
                    label: "Panel";
                    IconButton { icon: @image-url("../../assets/icons/ui/brain.svg"); label: "Mind"; tooltip: "Toggle MindSpace (Ctrl+M)"; tint: #b39ddb; clicked => { root.on-plugin-action("mindspace:toggle-panel"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Labels";
                    IconButton { icon: @image-url("../../assets/icons/ui/label.svg"); label: "Add"; tooltip: "Add Label (Ctrl+L)"; tint: #9575cd; clicked => { root.on-plugin-action("mindspace:add-label"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/close.svg"); label: "Remove"; tooltip: "Remove Label"; tint: #ef9a9a; clicked => { root.on-plugin-action("mindspace:remove-label"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "Connect";
                    IconButton { icon: @image-url("../../assets/icons/ui/link.svg"); label: "Connect"; tooltip: "Connect Nodes (Ctrl+K)"; tint: #66bb6a; clicked => { root.on-plugin-action("mindspace:connect"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/search.svg"); label: "Search"; tooltip: "Search Nodes (Ctrl+F)"; tint: #64b5f6; clicked => { root.on-plugin-action("mindspace:search"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "File";
                    IconButton { icon: @image-url("../../assets/icons/ui/import.svg"); label: "Import"; tooltip: "Import Mind Map"; tint: #4dd0e1; clicked => { root.on-plugin-action("mindspace:import"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/export.svg"); label: "Export"; tooltip: "Export Mind Map"; tint: #ef9a9a; clicked => { root.on-plugin-action("mindspace:export"); } }
                }
                GroupDivider {}
                
                ToolGroup {
                    label: "AI Tools";
                    IconButton { icon: @image-url("../../assets/icons/ui/suggest.svg"); label: "Suggest"; tooltip: "AI Suggestions"; tint: #81c784; clicked => { root.on-plugin-action("mindspace:ai-suggest"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/auto-layout.svg"); label: "Layout"; tooltip: "Auto Layout"; tint: #81c784; clicked => { root.on-plugin-action("mindspace:ai-layout"); } }
                    IconButton { icon: @image-url("../../assets/icons/ui/summary.svg"); label: "Summary"; tooltip: "Generate Summary"; tint: #81c784; clicked => { root.on-plugin-action("mindspace:ai-summarize"); } }
                }
            }
        }
    }
}
