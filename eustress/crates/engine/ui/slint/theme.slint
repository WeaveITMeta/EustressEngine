// ============================================================================
// Eustress Engine Studio - Theme Definition
// Professional dark/light theme with modern aesthetics
// ============================================================================

import { HorizontalBox, VerticalBox, LineEdit, ScrollView, Button, CheckBox, ComboBox, Slider, SpinBox, TextEdit } from "std-widgets.slint";

// Global theme colors - dark mode by default
export global Theme {
    // Primary colors — ultra-dark for AAA professional look
    out property <color> background-primary: #0e0e0e;
    out property <color> background-secondary: #121212;
    out property <color> background-tertiary: #1a1a1a;
    
    // Panel colors
    out property <color> panel-background: #121212;
    out property <color> header-background: #1a1a1a;
    out property <color> viewport-background: #0a0a0a;
    
    // Tab colors
    out property <color> tab-active: #121212;
    out property <color> tab-inactive: #181818;
    out property <color> tab-hover: #222222;
    
    // Text colors — high contrast for readability
    out property <color> text-primary: #d4d4d4;
    out property <color> text-secondary: #808080;
    out property <color> text-disabled: #4a4a4a;
    out property <color> text-accent: #4fc1ff;
    out property <color> text-error: #f14c4c;
    out property <color> text-warning: #cca700;
    out property <color> text-success: #4ec9b0;
    
    // Border colors — subtle, not distracting
    out property <color> border-color: #222222;
    out property <color> border-focus: #0078d4;
    out property <color> border-error: #f14c4c;
    
    // Button colors
    out property <color> button-background: #252525;
    out property <color> button-hover: #303030;
    out property <color> button-pressed: #1a1a1a;
    out property <color> button-primary: #0078d4;
    out property <color> button-primary-hover: #1a8ae8;
    
    // Input colors
    out property <color> input-background: #161616;
    out property <color> input-border: #2a2a2a;
    out property <color> input-focus: #0078d4;
    
    // Selection colors
    out property <color> selection-background: #14304a;
    out property <color> selection-border: #0078d4;
    
    // Overlay colors
    out property <color> overlay-background: #121212e8;
    out property <color> dialog-background: #1a1a1a;
    out property <color> modal-backdrop: #000000a0;
    
    // Accent colors — vibrant against dark backgrounds
    out property <color> accent-blue: #0078d4;
    out property <color> accent-green: #3cba54;
    out property <color> accent-orange: #e8912d;
    out property <color> accent-purple: #b180d7;
    out property <color> accent-red: #e74856;
    out property <color> accent-yellow: #f9c74f;
    
    // Ribbon colors
    out property <color> ribbon-background: #101010;
    out property <color> ribbon-tab-active: #121212;
    out property <color> ribbon-tab-inactive: #1a1a1a;
    out property <color> ribbon-separator: #222222;
    
    // Explorer colors
    out property <color> explorer-item-hover: #1a1a1a;
    out property <color> explorer-item-selected: #0a2e48;
    out property <color> explorer-folder: #e8b84a;
    out property <color> explorer-file: #c8c8c8;
    
    // Output console colors
    out property <color> output-info: #3794ff;
    out property <color> output-warning: #cca700;
    out property <color> output-error: #f14c4c;
    out property <color> output-debug: #858585;
    
    // Gizmo colors
    out property <color> gizmo-x: #f14c4c;
    out property <color> gizmo-y: #4ec9b0;
    out property <color> gizmo-z: #569cd6;
    
    // Shadows — deeper for dark theme
    out property <color> shadow-color: #00000080;
    
    // Spacing
    out property <length> spacing-xs: 2px;
    out property <length> spacing-sm: 4px;
    out property <length> spacing-md: 8px;
    out property <length> spacing-lg: 16px;
    out property <length> spacing-xl: 24px;
    
    // Border radius
    out property <length> radius-sm: 2px;
    out property <length> radius-md: 4px;
    out property <length> radius-lg: 8px;
    out property <length> radius-xl: 12px;
    
    // Font sizes
    out property <length> font-xs: 10px;
    out property <length> font-sm: 11px;
    out property <length> font-md: 13px;
    out property <length> font-lg: 15px;
    out property <length> font-xl: 18px;
    out property <length> font-xxl: 24px;
}

// Icon button component for consistent styling with hover tooltip and label
export component IconButton inherits Rectangle {
    in property <image> icon;
    in property <string> label: "";
    in property <string> tooltip: "";
    in property <bool> selected: false;
    in property <bool> enabled: true;
    in property <color> tint: #d4d4d4; // Tint color for SVG icon (default matches base icon grey)
    
    callback clicked();
    
    width: root.label != "" ? (label-measure.preferred-width > 34px ? label-measure.preferred-width + 10px : 44px) : 36px;
    height: root.label != "" ? 52px : 36px;
    
    // Hidden text for width measurement
    label-measure := Text {
        visible: false;
        text: root.label;
        font-size: 10px;
    }
    border-radius: Theme.radius-md;
    background: self.selected ? Theme.selection-background : 
                touch.has-hover ? Theme.button-hover : transparent;
    
    opacity: self.enabled ? 1.0 : 0.5;
    clip: false;
    
    touch := TouchArea {
        enabled: root.enabled;
        mouse-cursor: root.enabled ? pointer : default;
        clicked => { root.clicked(); }
        moved => {
            if root.tooltip != "" {
                tooltip-popup.show();
            }
        }
    }
    
    VerticalLayout {
        padding-top: root.label != "" ? 3px : 7px;
        padding-bottom: root.label != "" ? 2px : 0px;
        spacing: 2px;
        alignment: center;
        
        Image {
            width: 22px;
            height: 22px;
            source: root.icon;
            image-fit: contain;
            colorize: root.tint != transparent ? root.tint : transparent;
            horizontal-alignment: center;
        }
        
        if root.label != "": btn-label := Text {
            text: root.label;
            color: Theme.text-secondary;
            font-size: 10px;
            horizontal-alignment: center;
            overflow: elide;
        }
    }
    
    // Tooltip popup — uses PopupWindow for correct z-ordering above all panels
    tooltip-popup := PopupWindow {
        x: 0px;
        y: root.height + 4px;
        
        Rectangle {
            background: #1e1e1e;
            border-radius: 3px;
            border-width: 1px;
            border-color: #3a3a3a;
            drop-shadow-blur: 4px;
            drop-shadow-color: #00000060;
            
            HorizontalBox {
                padding-left: 6px;
                padding-right: 6px;
                padding-top: 3px;
                padding-bottom: 3px;
                
                Text {
                    text: root.tooltip;
                    color: #d4d4d4;
                    font-size: 11px;
                }
            }
        }
    }
}

// Toolbar separator
export component ToolbarSeparator inherits Rectangle {
    width: 1px;
    height: 20px;
    background: Theme.ribbon-separator;
}

// Panel header component
export component PanelHeader inherits Rectangle {
    in property <string> title: "";
    in property <bool> collapsible: false;
    in-out property <bool> collapsed: false;
    
    callback toggle-collapsed();
    
    height: 28px;
    background: Theme.header-background;
    
    HorizontalBox {
        padding-left: 8px;
        padding-right: 8px;
        spacing: 4px;
        
        if root.collapsible: TouchArea {
            width: 16px;
            clicked => { 
                root.collapsed = !root.collapsed;
                root.toggle-collapsed();
            }
            
            Image {
                width: 12px;
                height: 12px;
                source: root.collapsed ? @image-url("../../assets/icons/ui/chevron-right.svg") :
                        @image-url("../../assets/icons/ui/chevron-down.svg");
                image-fit: contain;
                vertical-alignment: center;
            }
        }
        
        Text {
            text: root.title;
            color: Theme.text-primary;
            font-weight: 500;
            vertical-alignment: center;
        }
        
        Rectangle { horizontal-stretch: 1; }
    }
}

// Property row component for properties panel
export component PropertyRow inherits Rectangle {
    in property <string> label: "";
    in property <string> value: "";
    in property <bool> editable: true;
    
    callback value-changed(string);
    
    height: 24px;
    background: transparent;
    
    HorizontalBox {
        padding-left: 8px;
        padding-right: 8px;
        spacing: 8px;
        
        Text {
            width: 100px;
            text: root.label;
            color: Theme.text-secondary;
            vertical-alignment: center;
            overflow: elide;
        }
        
        if root.editable: LineEdit {
            horizontal-stretch: 1;
            text: root.value;
            edited(text) => { root.value-changed(text); }
        }
        
        if !root.editable: Text {
            horizontal-stretch: 1;
            text: root.value;
            color: Theme.text-primary;
            vertical-alignment: center;
        }
    }
}

// Tree item component for explorer
export component TreeItem inherits Rectangle {
    in property <int> depth: 0;
    in property <image> icon;
    in property <string> label: "";
    in property <bool> expandable: false;
    in property <bool> expanded: false;
    in property <bool> selected: false;
    in property <bool> show: true;
    
    callback clicked();
    callback double-clicked();
    callback toggle-expanded();
    callback context-menu(length, length);
    
    height: root.show ? 22px : 0px;
    visible: root.show;
    background: self.selected ? Theme.explorer-item-selected : 
                row-touch.has-hover ? Theme.explorer-item-hover : transparent;
    
    // Full-row touch area for selection and context menu
    row-touch := TouchArea {
        clicked => { root.clicked(); }
        double-clicked => { root.double-clicked(); }
        pointer-event(event) => {
            if event.button == PointerEventButton.right && event.kind == PointerEventKind.up {
                root.context-menu(self.mouse-x, self.mouse-y);
            }
        }
    }
    
    // Expand/collapse arrow
    if root.expandable: TouchArea {
        x: 4px + root.depth * 16px;
        y: 0px;
        width: 16px;
        height: 22px;
        mouse-cursor: pointer;
        clicked => { root.toggle-expanded(); }
    }
    
    if root.expandable: Image {
        x: 4px + root.depth * 16px;
        y: 3px;
        width: 16px;
        height: 16px;
        source: root.expanded ? @image-url("../../assets/icons/ui/chevron-down.svg") :
                @image-url("../../assets/icons/ui/chevron-right.svg");
        image-fit: contain;
    }
    
    // SVG icon — pixel-perfect centered
    Image {
        x: 4px + root.depth * 16px + 16px;
        y: 3px;
        width: 16px;
        height: 16px;
        source: root.icon;
        image-fit: contain;
    }
    
    // Label
    Text {
        x: 4px + root.depth * 16px + 16px + 20px;
        y: 0px;
        width: root.width - (4px + root.depth * 16px + 16px + 20px + 4px);
        height: 22px;
        text: root.label;
        color: Theme.text-primary;
        font-size: 12px;
        vertical-alignment: center;
        overflow: elide;
    }
}

// Log entry component for output console
export component LogEntry inherits Rectangle {
    in property <string> level: "info";
    in property <string> timestamp: "";
    in property <string> message: "";
    
    height: 20px;
    background: transparent;
    
    // Level indicator SVG icon
    Image {
        x: 8px;
        y: 2px;
        width: 16px;
        height: 16px;
        source: root.level == "error" ? @image-url("../../assets/icons/ui/error.svg") :
                root.level == "warning" ? @image-url("../../assets/icons/ui/warning.svg") :
                root.level == "debug" ? @image-url("../../assets/icons/ui/debug.svg") :
                @image-url("../../assets/icons/ui/info.svg");
        image-fit: contain;
    }
    
    // Timestamp
    Text {
        x: 28px;
        y: 0px;
        width: 70px;
        height: 20px;
        text: root.timestamp;
        color: Theme.text-secondary;
        font-size: 10px;
        vertical-alignment: center;
    }
    
    // Message
    Text {
        x: 102px;
        y: 0px;
        width: root.width - 110px;
        height: 20px;
        text: root.message;
        color: root.level == "error" ? Theme.output-error :
               root.level == "warning" ? Theme.output-warning :
               root.level == "debug" ? Theme.output-debug : Theme.output-info;
        font-size: 12px;
        vertical-alignment: center;
        overflow: elide;
    }
}
