// ============================================================================
// Eustress Engine Studio - Asset Manager Panel
// Browse and import assets
// ============================================================================

import { VerticalBox, HorizontalBox, LineEdit, ScrollView, GridBox, ComboBox } from "std-widgets.slint";
import { Theme, PanelHeader } from "theme.slint";

// Asset data
export struct AssetData {
    id: string,
    name: string,
    asset-type: string,
    thumbnail: image,
    size: string,
    modified: string,
}

// Asset category
export struct AssetCategory {
    name: string,
    count: int,
}

component AssetCard inherits Rectangle {
    in property <string> name: "";
    in property <string> asset-type: "";
    in property <bool> selected: false;
    
    callback clicked();
    callback double-clicked();
    callback context-menu();
    
    width: 100px;
    height: 120px;
    background: self.selected ? Theme.selection-background : 
                touch.has-hover ? Theme.explorer-item-hover : transparent;
    border-radius: 4px;
    
    touch := TouchArea {
        clicked => { root.clicked(); }
        double-clicked => { root.double-clicked(); }
        pointer-event(event) => {
            if event.button == PointerEventButton.right && event.kind == PointerEventKind.up {
                root.context-menu();
            }
        }
    }
    
    VerticalBox {
        padding: 4px;
        spacing: 4px;
        
        // Thumbnail placeholder
        Rectangle {
            height: 80px;
            background: Theme.background-tertiary;
            border-radius: 4px;
            
            Text {
                text: root.asset-type == "Model" ? "üì¶" :
                      root.asset-type == "Image" ? "üñº" :
                      root.asset-type == "Audio" ? "üîä" :
                      root.asset-type == "Script" ? "üìú" : "üìÑ";
                color: Theme.text-secondary;
                font-size: 32px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
        
        // Name
        Text {
            text: root.name;
            color: Theme.text-primary;
            font-size: 11px;
            horizontal-alignment: center;
            overflow: elide;
        }
    }
}

export component AssetManager inherits Rectangle {
    // Properties
    in property <[AssetData]> assets: [];
    in property <[AssetCategory]> categories: [];
    in property <string> current-category: "All";
    in-out property <string> search-text: "";
    in property <string> sort-by: "Name";
    
    // Callbacks
    callback on-select-asset(string);
    callback on-import-asset(string);
    callback on-delete-asset(string);
    callback on-search-changed(string);
    callback on-category-changed(string);
    
    background: Theme.panel-background;
    
    VerticalBox {
        padding: 0px;
        spacing: 0px;
        
        // Toolbar
        Rectangle {
            height: 36px;
            background: Theme.header-background;
            
            HorizontalBox {
                padding: 4px;
                spacing: 8px;
                
                // Search
                Rectangle {
                    horizontal-stretch: 1;
                    background: Theme.input-background;
                    border-radius: 4px;
                    border-width: 1px;
                    border-color: Theme.input-border;
                    
                    HorizontalBox {
                        padding-left: 8px;
                        padding-right: 8px;
                        
                        Text {
                            width: 16px;
                            text: "üîç";
                            color: Theme.text-secondary;
                            vertical-alignment: center;
                        }
                        
                        LineEdit {
                            horizontal-stretch: 1;
                            placeholder-text: "Search assets...";
                            text <=> root.search-text;
                            edited(text) => { root.on-search-changed(text); }
                        }
                    }
                }
                
                // Import button
                Rectangle {
                    width: 70px;
                    height: 28px;
                    background: Theme.button-primary;
                    border-radius: 4px;
                    
                    TouchArea {
                        clicked => { root.on-import-asset(""); }
                    }
                    
                    Text {
                        text: "+ Import";
                        color: white;
                        font-size: 12px;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                }
            }
        }
        
        // Category tabs
        Rectangle {
            height: 32px;
            background: Theme.background-secondary;
            
            HorizontalBox {
                padding-left: 8px;
                padding-right: 8px;
                spacing: 4px;
                
                Rectangle {
                    width: 50px;
                    background: root.current-category == "All" ? Theme.tab-active : transparent;
                    border-radius: 4px;
                    
                    TouchArea {
                        clicked => { root.on-category-changed("All"); }
                    }
                    
                    Text {
                        text: "All";
                        color: root.current-category == "All" ? Theme.text-primary : Theme.text-secondary;
                        font-size: 12px;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                }
                
                Rectangle {
                    width: 60px;
                    background: root.current-category == "Models" ? Theme.tab-active : transparent;
                    border-radius: 4px;
                    
                    TouchArea {
                        clicked => { root.on-category-changed("Models"); }
                    }
                    
                    Text {
                        text: "Models";
                        color: root.current-category == "Models" ? Theme.text-primary : Theme.text-secondary;
                        font-size: 12px;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                }
                
                Rectangle {
                    width: 60px;
                    background: root.current-category == "Images" ? Theme.tab-active : transparent;
                    border-radius: 4px;
                    
                    TouchArea {
                        clicked => { root.on-category-changed("Images"); }
                    }
                    
                    Text {
                        text: "Images";
                        color: root.current-category == "Images" ? Theme.text-primary : Theme.text-secondary;
                        font-size: 12px;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                }
                
                Rectangle {
                    width: 50px;
                    background: root.current-category == "Audio" ? Theme.tab-active : transparent;
                    border-radius: 4px;
                    
                    TouchArea {
                        clicked => { root.on-category-changed("Audio"); }
                    }
                    
                    Text {
                        text: "Audio";
                        color: root.current-category == "Audio" ? Theme.text-primary : Theme.text-secondary;
                        font-size: 12px;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                }
                
                Rectangle { horizontal-stretch: 1; }
            }
        }
        
        // Asset grid
        ScrollView {
            vertical-stretch: 1;
            
            if root.assets.length == 0: Rectangle {
                VerticalBox {
                    alignment: center;
                    
                    Text {
                        text: "üì¶";
                        color: Theme.text-secondary;
                        font-size: 48px;
                        horizontal-alignment: center;
                    }
                    
                    Text {
                        text: "No assets found";
                        color: Theme.text-secondary;
                        horizontal-alignment: center;
                    }
                    
                    Text {
                        text: "Import assets to get started";
                        color: Theme.text-disabled;
                        font-size: 12px;
                        horizontal-alignment: center;
                    }
                }
            }
            
            if root.assets.length > 0: VerticalBox {
                padding: 8px;
                
                // Asset cards in a flow layout (simplified as horizontal boxes)
                for asset in root.assets: AssetCard {
                    name: asset.name;
                    asset-type: asset.asset-type;
                    clicked => { root.on-select-asset(asset.id); }
                }
            }
        }
    }
}
